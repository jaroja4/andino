class Email{constructor(id,email_name,email_user,email_password,email_SMTPAuth,email_Host,email_port,activa,email_subject,email_SMTPSecure,email_body,email_logo,estadoLogo,html,email_footer){this.id=id||null,this.email_name=email_name||"",this.email_user=email_user||"",this.email_password=email_password||"",this.email_SMTPAuth=email_SMTPAuth||"true",this.email_Host=email_Host||"",this.email_port=email_port||"",this.activa=activa||1,this.email_subject=email_subject||"",this.email_SMTPSecure=email_SMTPSecure||"ssl",this.email_body=email_body||"",this.email_logo=email_logo||"",this.estadoLogo=estadoLogo||!1,this.html=html||"",this.email_footer=email_footer||""}get read(){$.ajax({type:"POST",url:"class/email.php",data:{action:"read"}}).done(function(e){"null"!=e&&email.showItemData(e)}).fail(function(e){email.showError(e)})}get save(){var miAccion=null==this.id?"create":"update";this.email_name=$("#email_name").val(),this.email_user=$("#email_user").val(),this.email_password=$("#email_password").val(),this.email_Host=$("#email_Host option:selected").text(),this.email_port=$("#email_port").val(),this.email_subject=$("#email_subject").val(),this.email_SMTPSecure=$("#email_SMTPSecure").val(),this.email_body=$("#email_body").val(),this.html=$("#html").val(),this.email_footer=$("#email_footer").val(),$("#btnSubmit").attr("disabled","disabled"),$.ajax({type:"POST",url:"class/email.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(function(e){null!=dz?dz.processQueue():email.showInfo(),email.id=JSON.parse(e)}).fail(function(e){email.showError(e)}).always(function(){$("#btnSubmit").removeAttr("disabled")})}showInfo(){$(".close").click(),swal({type:"success",title:"Good!",showConfirmButton:!1,timer:750})}showError(e){var data=JSON.parse(e.responseText);session.in(data),swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}clearCtls(){$("#id").val(""),$("#email_name").val(""),$("#email_user").val(""),$("#email_password").val(""),$("#email_Host option").prop("selected",!1),$("#email_Host").selectpicker("refresh"),$("#email_port").val(""),$("#email_subject").val(""),$("#email_SMTPSecure").val(""),$("#email_SMTPAuth").val(""),$("#email_body").val(""),$("#html").val(""),$("#email_footer").val(""),$("#filelist").html(""),null!=dz&&dz.removeAllFiles()}showItemData(e){if(this.clearCtls(),"null"!=e&&""!=e){var data=JSON.parse(e);if(null==data.id)return;email=new Email(data.id,data.email_name,data.email_user,data.email_password,data.email_SMTPAuth,data.email_Host,data.email_port,data.activa,data.email_subject,data.email_SMTPSecure,data.email_body,data.email_logo,data.estadoLogo,data.html,data.email_footer),$("#email_name").val(email.email_name),$("#email_user").val(email.email_user),$("#email_password").val(email.email_password),$("#email_SMTPAuth").val(email.email_SMTPAuth),email.email_Host="smtp.gmail.com"==email.email_Host?1:2,$("#email_Host option[value="+email.email_Host+"]").prop("selected",!0),$("#email_Host").selectpicker("refresh"),$("#email_port").val(email.email_port),$("#email_subject").val(email.email_subject),$("#email_SMTPSecure").val(email.email_SMTPSecure),$("#email_body").val(email.email_body),$("#html").val(email.html),$("#email_footer").val(email.email_footer),$("#filelist").append(`\n                <div class="btn-group">\n                    <button type="button" class="btn ${1==email.estadoLogo?"btn-success":"btn-danger"}">${email.email_logo}</button>\n                    <button type="button" class="btn ${1==email.estadoLogo?"btn-success":"btn-danger"} dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                        <span class="caret"></span>\n                         <span class="sr-only">Toggle Dropdown</span>\n                    </button>\n                    ${1==email.estadoLogo?`\n                        <ul class="dropdown-menu" role="menu">\n                            <li><a id='certEliminar'>Eliminar</a></li>\n                            <li class="divider"></li>\n                            <li><a href='class/downloadCert.php?email_logo=${email.email_logo}' id='certDescargar'>Descargar</a></li>\n                        </ul>`:""}\n                </div>           \n            `).fadeIn(),0==email.estadoLogo&&swal({type:"error",title:"Oops...",text:"Ha ocurrido un error al localizar el email_logo.",footer:"<a href>Contacte a Soporte Técnico</a>"})}}init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms.frm);$("#frm").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&email.save,!1}),document.forms.frm.onreset=function(e){validator.reset()},$(function(){$(document).ajaxStart(NProgress.start).ajaxStop(NProgress.done)}),Dropzone.options.frmLogo={init:function(){this.on("addedfile",function(file){dz=this,email.email_logo=dz.files[0].name}),this.on("complete",function(file){"UPLOADED"!=file.xhr.response?(swal({type:"error",title:"Oops...",text:"Ha ocurrido un error al subir la imagen.",footer:"<a href>Contacte a Soporte Técnico</a>"}),$(file.previewElement).addClass("dz-error-message"),$("#filelist").html(""),email.email_logo=null):email.showInfo()}),this.on("error",function(file){swal({type:"error",title:"Oops...",text:"Imagen con error",footer:"<a href>Contacte a Soporte Técnico</a>"}),this.removeFile(file)}),this.on("canceled",function(file){swal({type:"error",title:"Oops...",text:"Imagen cancelada",footer:"<a href>Contacte a Soporte Técnico</a>"})})},autoProcessQueue:!1,acceptedFiles:"image/png",maxFiles:1,addRemoveLinks:!0,autoDiscover:!1},$("#btnSubmit").click(function(){$("#frm").submit()}),$("#btnPrueba").click(function(){swal({title:"Correo electrónico a enviar",input:"text",showCancelButton:!0,confirmButtonColor:"#1FAB45",confirmButtonText:"Enviar",cancelButtonText:"Cancelar",buttonsStyling:!0,preConfirm:function(iput_mail){return new Promise(function(resolve){email.extraMails=iput_mail,$.ajax({type:"POST",url:"class/email.php",data:{action:"test",mailAddress:JSON.stringify(email.extraMails)},cache:!1,success:function(response){swal({position:"top-end",type:"success",title:"Prueba enviada!",showConfirmButton:!1,timer:750})},failure:function(response){swal("Internal Error","Oops, el correo no fue enviado.","error")}})})},allowOutsideClick:!1})})}}let email=new Email;var dz;