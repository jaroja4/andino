class Usuario{constructor(id,nombre,password,email,activo,r){this.id=id||null,this.nombre=nombre||"",this.password=password||"",this.email=email||"",this.activo=activo||0,this.listarol=r||null}get Read(){var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tableBody-Usuario").length||$.ajax({type:"POST",url:"class/usuario.php",data:{action:miAccion,id:this.id}}).done(function(e){usuario.Reload(e)}).fail(function(e){usuario.showError(e)})}get Save(){$("#btnUsuario").attr("disabled","disabled");var miAccion=null==this.id?"Create":"Update";this.nombre=$("#nombre").val(),this.password==$("#password").val()?this.password="NOCHANGED":this.password=$("#password").val(),this.email=$("#email").val(),this.activo=$("#activo")[0].checked||!0,$.ajax({type:"POST",url:"class/usuario.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(function(e){swal({type:"info",title:"Usuario",text:"Usuario agregado correctamente!",footer:'<a href="login.html">Login</a>'})}).fail(function(e){usuario.showError(e)}).always(function(){setTimeout('$("#btnUsuario").removeAttr("disabled")',1e3),(usuario=new Usuario).ClearCtls(),usuario.Read,$("#nombre").focus()})}get Delete(){$.ajax({type:"POST",url:"class/usuario.php",data:{action:"Delete",id:this.id}}).done(function(e){var data=JSON.parse(e);0==data.status?swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3}):1==data.status?swal({type:"error",title:"No es posible eliminar...",text:"El registro que intenta eliminar tiene objetos relacionados"}):swal({type:"error",title:"Ha ocurrido un error...",text:"El registro no ha sido eliminado",footer:"<a href>Contacte a Soporte Técnico</a>"})}).fail(function(e){usuario.showError(e)}).always(function(){(usuario=new Usuario).Read})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}showInfo(){$(".close").click(),swal({position:"top-end",type:"success",title:"Good!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);session.in(data),swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#id").val(""),$("#nombre").val(""),$("#password").val(""),$("#repetir").val(""),$("#email").val(""),$("#activo")[0].checked=!0,$("#rol option").prop("selected",!1),$("#rol").selectpicker("refresh"),$("#checkusername").removeClass("fa-check-circle"),$("#checkusername").removeClass("fa-times-circle"),$("#checkusername").text("")}ShowAll(e){$("#tableBody-Usuario").html("");var data=JSON.parse(e);if($.each(data,function(i,item){$("#tableBody-Usuario").append(`\n                <tr> \n                    <td class="a-center ">\n                        <input type="checkbox" class="flat" name="table_records">\n                    </td>\n                    <td class="itemId" >${item.id}</td>\n                    <td>${item.nombre}</td>\n                    <td>${item.email}</td>\n                    <td>${item.activo}</td>\n                    <td class=" last">\n                        <a id="update${item.id}" data-toggle="modal" data-target=".bs-example-modal-lg" > <i class="glyphicon glyphicon-edit" > </i> Editar </a> | \n                        <a id="delete${item.id}"> <i class="glyphicon glyphicon-trash"> </i> Eliminar </a>\n                    </td>\n                </tr>\n            `),$("#update"+item.id).click(usuario.UpdateEventHandler),$("#delete"+item.id).click(usuario.DeleteEventHandler)}),$.fn.dataTable.isDataTable("#dsUsuario"))var table=$("#dsUsuario").DataTable();else $("#dsUsuario").DataTable({columns:[{title:"Check"},{title:"ID"},{title:"Nombre"},{title:"eMail"},{title:"Activo"},{title:"Action"}],paging:!0,search:!0})}UpdateEventHandler(){usuario.id=$(this).parents("tr").find(".itemId").text(),usuario.Read}ShowItemData(e){this.ClearCtls();var data=JSON.parse(e);usuario=new Usuario(data.id,data.nombre,data.password,data.email,data.activo,data.listarol),$("#id").val(usuario.id),$("#nombre").val(usuario.nombre),$("#password").val(usuario.password),$("#repetir").val(usuario.password),1==usuario.activo?$("#activo")[0].checked=!0:$("#activo")[0].checked=!1,$("#email").val(usuario.email),$.each(usuario.listarol,function(i,item){$("#rol option[value="+item.id+"]").prop("selected",!0)}),$("#rol").selectpicker("refresh")}DeleteEventHandler(){usuario.id=$(this).parents("tr").find(".itemId").text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&usuario.Delete})}checkUsername(){if(""!=$("#email").val()){$("#btnUsuario").attr("disabled","disabled");var miAccion="checkUsername";this.email=$("#email").val(),$.ajax({type:"POST",url:"class/usuario.php",data:{action:miAccion,email:this.email}}).done(function(e){var data;0==JSON.parse(e).status?($("#checkusername").removeClass("fa-times-circle"),$("#checkusername").addClass("fa-check-circle"),$("#btnUsuario").removeAttr("disabled"),$("#checkusername").text(" Nombre de usuario único.")):($("#checkusername").removeClass("fa-check-circle"),$("#checkusername").addClass("fa-times-circle"),$("#checkusername").text(" Nombre de usuario repetido."))}).fail(function(e){usuario.showError(e)})}}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms[0]);$("#frmUsuario").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&usuario.Save,!1}),document.forms[0].onreset=function(e){validator.reset()},$("#email").focusout(function(){usuario.checkUsername()})}}let usuario=new Usuario;