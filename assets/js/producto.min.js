class Producto{constructor(id,nombre,nombreAbreviado,descripcion,cantidad,precio,scancode,codigoRapido,fechaExpiracion,cat,UltPro){this.id=id||null,this.nombre=nombre||"",this.nombreAbreviado=nombreAbreviado||"",this.descripcion=descripcion||"",this.cantidad=cantidad||0,this.precio=precio||0,this.scancode=scancode||"",this.codigoRapido=codigoRapido||"",this.fechaExpiracion=fechaExpiracion||null,this.listacategoria=cat||null,this.UltPro=UltPro||null}get Read(){var miAccion=null==this.id?"ReadAll":"Read";"ReadAll"==miAccion&&0==$("#tableBody-Producto").length||$.ajax({type:"POST",url:"class/Producto.php",data:{action:miAccion,id:this.id}}).done(function(e){producto.Reload(e)}).fail(function(e){producto.showError(e)})}get Save(){$("#btnProducto").attr("disabled","disabled");var miAccion=null==this.id?"Create":"Update";this.nombre=$("#nombre").val(),this.nombreAbreviado=$("#nombreAbreviado").val(),this.descripcion=$("#descripcion").val(),this.cantidad=$("#cantidad").val(),this.precio=$("#precio").val(),this.scancode=$("#scancode").val(),this.codigoRapido=$("#codigoRapido").val(),this.fechaExpiracion=""==$("#fechaExpiracion").val()?null:moment($("#fechaExpiracion").val(),"DD/MM/YYYY").unix(),this.listacategoria=$("#categoria > option:selected").map(function(){return this.value}).get(),$.ajax({type:"POST",url:"class/Producto.php",data:{action:miAccion,obj:JSON.stringify(this)}}).done(producto.showInfo).fail(function(e){producto.showError(e)}).always(function(){setTimeout('$("#btnProducto").removeAttr("disabled")',1e3),(producto=new Producto).ClearCtls(),producto.Read,$("#nombre").focus()})}get Delete(){$.ajax({type:"POST",url:"class/Producto.php",data:{action:"Delete",id:this.id}}).done(function(e){var data=JSON.parse(e);0==data.status?swal({type:"success",title:"Eliminado!",showConfirmButton:!1,timer:1e3}):1==data.status?swal({type:"error",title:"No es posible eliminar...",text:"El registro que intenta eliminar tiene objetos relacionados"}):swal({type:"Error",title:"Ha ocurrido un error...",text:"El registro no ha sido eliminado",footer:"<a href>Contacte a Soporte Técnico</a>"})}).fail(function(e){producto.showError(e)}).always(function(){(producto=new Producto).Read})}Reload(e){null==this.id?this.ShowAll(e):this.ShowItemData(e)}showInfo(){$(".close").click(),swal({position:"top-end",type:"success",title:"Good!",showConfirmButton:!1,timer:1e3})}showError(e){var data=JSON.parse(e.responseText);session.in(data)&&swal({type:"error",title:"Oops...",text:"Algo no está bien ("+data.code+"): "+data.msg,footer:"<a href>Contacte a Soporte Técnico</a>"})}ClearCtls(){$("#id").val(""),$("#nombre").val(""),$("#nombreAbreviado").val(""),$("#descripcion").val(""),$("#cantidad").val(""),$("#precio").val(""),$("#scancode").val(""),$("#codigoRapido").val(""),$("#fechaExpiracion").val(""),$("#categoria option").prop("selected",!1)}ShowAll(e){$("#tableBody-Producto").html("");var data=JSON.parse(e);if($.each(data,function(i,item){$("#tableBody-Producto").append(`\n                <tr> \n                    <td class="a-center ">\n                        <input type="checkbox" class="flat" name="table_records">\n                    </td>\n                    <td class="itemId" >${item.id}</td>\n                    <td>${item.nombre}</td>\n                    <td>${item.codigoRapido}</td>\n                    <td>${item.cantidad}</td>\n                    <td>${item.precio}</td>\n                    <td class=" last">\n                        <a id="update${item.id}" data-toggle="modal" data-target=".bs-example-modal-lg" > <i class="glyphicon glyphicon-edit" > </i> Editar </a> | \n                        <a id="delete${item.id}"> <i class="glyphicon glyphicon-trash"> </i> Eliminar </a>\n                    </td>\n                </tr>\n            `),$("#update"+item.id).click(producto.UpdateEventHandler),$("#delete"+item.id).click(producto.DeleteEventHandler)}),$.fn.dataTable.isDataTable("#dsProducto"))var table=$("#dsProducto").DataTable();else $("#dsProducto").DataTable({columns:[{title:"Check"},{title:"ID"},{title:"Nombre"},{title:"Código Rapido"},{title:"Cantidad"},{title:"Precio"},{title:"Action"}],paging:!0,search:!0})}UpdateEventHandler(){producto.id=$(this).parents("tr").find(".itemId").text(),producto.Read}ShowItemData(e){this.ClearCtls();var data=JSON.parse(e);producto=new Producto(data.id,data.nombre,data.nombreAbreviado,data.descripcion,data.cantidad,data.precio,data.scancode,data.codigoRapido,data.fechaExpiracion,data.listacategoria),$("#id").val(producto.id),$("#nombre").val(producto.nombre),$("#nombreAbreviado").val(producto.nombreAbreviado),$("#descripcion").val(producto.descripcion),$("#precio").val(producto.precio),$("#cantidad").val(producto.cantidad),$("#scancode").val(producto.scancode),$("#codigoRapido").val(producto.codigoRapido),$("#fechaExpiracion").val(null==producto.fechaExpiracion?null:moment(producto.fechaExpiracion,"X").format("DD/MM/YYYY")),$.each(producto.listacategoria,function(i,item){$("#categoria option[value="+item.id+"]").prop("selected",!0)})}DeleteEventHandler(){producto.id=$(this).parents("tr").find(".itemId").text(),swal({title:"Eliminar?",text:"Esta acción es irreversible!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"No, cancelar!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger"}).then(result=>{result.value&&producto.Delete})}Init(){var validator=new FormValidator({events:["blur","input","change"]},document.forms[0]);$("#frmProducto").submit(function(e){var validatorResult;return e.preventDefault(),validator.checkAll(this).valid&&producto.Save,!1}),document.forms[0].onreset=function(e){validator.reset()},$("#dpfechaExpiracion").datetimepicker({format:"DD/MM/YYYY"})}}let producto=new Producto;