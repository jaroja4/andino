class Factura{constructor(id,cajero,productos,descuento,total,fechaCreacion,importe,idusuario,idcliente,idMedioPago){this.id=id||null,this.cajero=cajero||"",this.idusuario=idusuario||"",this.idcliente=idcliente||"",this.descuento=descuento||0,this.producto=producto||new Array(new Array),this.total=total||"",this.fechaCreacion=fechaCreacion||null,this.importe=importe||0,this.idMedioPago=idMedioPago||1}checkProfileContribuyente(){$(".main_container").attr("style","visibility:hidden"),$.ajax({type:"POST",url:"class/entidad.php",data:{action:"checkProfile"}}).done(function(e){var data=JSON.parse(e);0==data.status?swal({type:"warning",title:"Contribuyente",text:"Contribuyente no registrado para Facturación Electrónica",footer:'<a href="contribuyente.html">Agregar Contribuyente</a>'}).then(result=>{result.value&&(location.href="dashboard.html")}):($(".call_idDocumento").text(1==data.idDocumento?"Factura Electrónica":"Tiquete Electrónico"),$(".main_container").removeAttr("style"))}).fail(function(e){showError(e)})}}let factura=new Factura;function facCard(){factura.idMedioPago=2,$("#formapago").empty();var DivCard='<div class="row">\n        <div class="col-md-4 col-md-offset-4 col-sm-offset-0 col-xs-6 col-xs-offset-0">\n            <h3 class="text-left" >Ingrese Ref.:</h3>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4 col-md-offset-4">\n            <input id="pagotarjeta" class="input-lg valPago" type="number" onkeyup="valPago(this.value)" placeholder="Ingrese Numero Referencia" required="" minlength="5" autofocus="">\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4 col-md-offset-4 col-sm-offset-0 col-xs-6 col-xs-offset-0">\n            <button type="button" onclick="CreateFact()" class="btn btn-primary procesarFac" disabled style="margin-top:10px;">Facturar</button>\n        </div>\n    </div>';$("#formapago").append(DivCard),$("#btn-formapago").empty();var DivCard='<button type="button" id="btn_open_modal_agregar_cliente" onclick="btn_open_modal_agregar_cliente()" class="btn btn-warning disableBTN">Receptor</button>  \n    <button type="button" id="modalFormaPago" onclick="btnFormaPago()"class="btn btn-primary disableBTN">Atras</button>';$("#btn-formapago").append(DivCard),$("#pagotarjeta").on("keyup",function(e){var keyCode;13===(e.keyCode||e.which)&&""!=$("#pagotarjeta").val()&&CreateFact()}),$("#pagotarjeta").focus()}function facCash(){factura.idMedioPago=1,$("#formapago").empty();var DivCash='<div class="row">\n        <div class="col-md-4 col-md-offset-4 col-sm-offset-0 col-xs-6 col-xs-offset-0">\n            <h3 class="text-left" >Paga con:</h3>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4 col-md-offset-4">\n            <input id="pagocash" class="input-lg valPago" onkeyup="valPago(this.value)" type="number" placeholder="Ingrese Monto en Efectivo"  required="" minlength="5" autofocus="">\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4 col-md-offset-4 col-sm-offset-0 col-xs-6 col-xs-offset-0">\n            <button type="button" onclick="CreateFact()" class="btn btn-primary procesarFac" disabled style="margin-top:10px;">Facturar</button>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4 col-md-offset-4 col-sm-offset-0 col-xs-6 col-xs-offset-0">\n            <h3 class="text-left" id="vuelto">Su vuelto:</h3>\n        </div>\n    </div>';$("#formapago").append(DivCash),$("#btn-formapago").empty();var DivCash='<button type="button" id="btn_open_modal_agregar_cliente" onclick="btn_open_modal_agregar_cliente()" class="btn btn-warning disableBTN">Receptor</button>  \n    <button type="button" id="modalFormaPago" onclick="btnFormaPago()" class="btn btn-primary disableBTN">Atras</button>';$("#btn-formapago").append(DivCash),$("#pagocash").on("keyup",function(e){var keyCode;13===(e.keyCode||e.which)&&CreateFact()}),$("#pagocash").focus()}function agregarProducto(){AgregaProductodManual($("#inp_descripcion").val(),$("#inp_precio").val()),$("#inp_descripcion").val(""),$("#inp_precio").val(""),$("#btn_agregarProducto").attr("disabled","disabled"),$("#inp_descripcion").focus()}function abrirModalPago(){var attr=$("#btn_open_modal_fac").attr("disabled");if(void 0!==attr&&!1!==attr)return swal({type:"warning",text:"Debe agregar productos a la lista.",timer:2e3}),$("#inp_descripcion").focus(),!1;var totalTemp="";$("#total_pagar").empty(),$("#total_pagar").append("Total a Pagar: ¢"+factura.totalComprobante.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")),btnFormaPago(),$(".factura-modal-lg").modal("show"),$(".factura-modal-lg").bind("keydown",function(e){37==e.keyCode&&facCard()}),$(".factura-modal-lg").bind("keydown",function(e){39==e.keyCode&&facCash()})}function btnFormaPago(){$("#formapago").empty();var DivCash='<div class="col-md-2"></div>\n    <div class="col-md-3" onclick="facCard()">\n        <img id="fac-ccard" src="images/credit-cards.png" class="modal-img-pago">\n        <strong><p class="text-center">Tarjeta</p></strong>\n    </div>\n    <div class="col-md-2"></div>\n    <div class="col-md-3" onclick="facCash()">\n        <img id="fac-cash" src="images/cash.png" class="modal-img-pago">\n        <strong><p class="text-center">Efectivo</p></strong>\n    </div>';$("#formapago").append(DivCash),$("#btn-formapago").empty();var DivCash='<button type="button" id="btn_open_modal_agregar_cliente" onclick="btn_open_modal_agregar_cliente()" class="btn btn-warning">Receptor</button>  \n    <button type="button" id="modalPago" class="btn btn-primary" data-dismiss="modal">Atras</button>';$("#btn-formapago").append(DivCash)}function valPago(val){pago=parseFloat($(".valPago").val()),isNaN($(".valPago").val())?(val=val.replace(/[^0-9]/g,""),$(".valPago").val(val)):pago>=factura.totalComprobante.toFixed(2)?($(".procesarFac").prop("disabled",!1),calcVuelto(pago,factura.totalComprobante)):$(".procesarFac").prop("disabled",!0)}function alertFact(){swal({type:"success",text:"Factura Lista!",timer:2e3}),$(".procesarFac").prop("disabled",!0),setTimeout(function(){location.reload()},2e3)}function calcVuelto(pago,xPagar){vuelto=(pago-xPagar).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".").toString(),$("#vuelto")[0].textContent="Su cambio: "+vuelto}function showError(e){var data=JSON.parse(e.responseText);alert("ERROR")}function CleanCtls(){$("#p_searh").val("")}function AgregaProductodManual(descripcion,precio){if(precio<1)return swal({type:"warning",text:"El precio unitario no puede ser negativo.",timer:2e3}),$("#inp_descripcion").focus(),!1;t.row.add([descripcion,precio,null,precio]).draw(!1),calcTotal(),$("#btn_open_modal_fac").attr("disabled",!1)}function calcTotal(){var subT=0;$(document.getElementById("productos").rows)[0].childElementCount>2?($(document.getElementById("productos").rows).each(function(i,item){rowTotal=item.childNodes[3].textContent.replace("¢",""),rowTotal=rowTotal.replace(/,/g,""),1==document.getElementById("rd_conImpuestos").checked?subT+=parseFloat(rowTotal)/1.13:subT+=parseFloat(rowTotal)}),factura.totalVentaneta=subT,factura.totalImpuesto=factura.totalVentaneta*(parseFloat($("#iv_100")[0].textContent.replace("%",""))/100),factura.totalComprobante=factura.totalVentaneta+factura.totalImpuesto,$("#subtotal")[0].textContent="¢"+factura.totalVentaneta.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),$("#iv_val")[0].textContent="¢"+factura.totalImpuesto.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),$("#total")[0].textContent="¢"+factura.totalComprobante.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")):($("#open_modal_fac").attr("disabled",!0),$("#subtotal")[0].textContent="¢0",$("#iv_val")[0].textContent="¢0",$("#total")[0].textContent="¢0")}function CreateFact(){var attr=$(".procesarFac").attr("disabled","disabled"),attr=$(".disableBTN").attr("disabled","disabled"),miAccion="create";factura.totalVenta=0,factura.totalDescuentos=0,factura.totalVentaneta=0,factura.totalImpuesto=0,factura.totalComprobante=0,factura.detalleFactura=[],$(document.getElementById("productos").rows).each(function(i,item){var precioUnitarioTemporal="",objetoDetalleFactura=new Object;objetoDetalleFactura.cantidad=parseFloat(item.cells[2].children[0].value),objetoDetalleFactura.detalle=item.cells[0].textContent,precioUnitarioTemporal=(precioUnitarioTemporal=item.cells[1].textContent.replace("¢","")).replace(/,/g,""),1==document.getElementById("rd_conImpuestos").checked?(objetoDetalleFactura.codigoImpuesto=1,objetoDetalleFactura.tarifaImpuesto=13):(objetoDetalleFactura.tarifaImpuesto=0,objetoDetalleFactura.codigoImpuesto=0),objetoDetalleFactura.precioUnitario=parseFloat((precioUnitarioTemporal/(1+objetoDetalleFactura.tarifaImpuesto/100)).toFixed(5)),objetoDetalleFactura.numeroLinea=i+1,objetoDetalleFactura.idTipoCodigo=1,objetoDetalleFactura.codigo=item[1],objetoDetalleFactura.idUnidadMedida=78,objetoDetalleFactura.montoTotal=parseFloat((objetoDetalleFactura.precioUnitario*objetoDetalleFactura.cantidad).toFixed(5)),objetoDetalleFactura.montoDescuento=0,objetoDetalleFactura.naturalezaDescuento="No aplican descuentos",objetoDetalleFactura.subTotal=parseFloat((objetoDetalleFactura.montoTotal-objetoDetalleFactura.montoDescuento).toFixed(5)),objetoDetalleFactura.montoImpuesto=parseFloat((objetoDetalleFactura.subTotal*(objetoDetalleFactura.tarifaImpuesto/100)).toFixed(5)),objetoDetalleFactura.montoTotalLinea=parseFloat((objetoDetalleFactura.subTotal+objetoDetalleFactura.montoImpuesto).toFixed(5)),factura.detalleFactura.push(objetoDetalleFactura),factura.totalVenta=parseFloat((factura.totalVenta+objetoDetalleFactura.montoTotal).toFixed(5)),factura.totalDescuentos=parseFloat((factura.totalDescuentos+objetoDetalleFactura.montoDescuento).toFixed(5)),factura.totalImpuesto=parseFloat((factura.totalImpuesto+objetoDetalleFactura.montoImpuesto).toFixed(5))}),factura.totalServGravados=0,factura.totalServExentos=0,factura.totalMercanciasGravadas=factura.totalVenta,factura.totalMercanciasExentas=0,factura.totalGravado=parseFloat((factura.totalServGravados+factura.totalMercanciasGravadas).toFixed(5)),factura.totalExento=parseFloat((factura.totalServExentos+factura.totalMercanciasExentas).toFixed(5)),factura.totalVenta=parseFloat((factura.totalGravado+factura.totalExento).toFixed(5)),factura.totalVentaneta=parseFloat((factura.totalVenta-factura.totalDescuentos).toFixed(5)),factura.totalComprobante=parseFloat((factura.totalVentaneta+factura.totalImpuesto).toFixed(5)),factura.idReceptor=receptor.id,$.ajax({type:"POST",url:"class/factura.php",data:{action:"create",obj:JSON.stringify(factura),dataReceptor:JSON.stringify(receptor)}}).done(function(){alertFact()}).fail(function(e){producto.showError(e)}).always(function(){setTimeout($("#btnProducto").removeAttr("disabled"),5e3),producto=new Producto,producto.ClearCtls(),producto.Read,$("#inp_descripcion").focus()})}